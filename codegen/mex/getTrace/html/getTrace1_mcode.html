<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T1U3">Trace</span> = getTrace(<span class="var type1" id="S3T2U6">OB</span>,<span class="var type1" id="S4T2U7">frame</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%% TrackFrame</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%thr = Settings.Silhouettethreshold*255;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="mxinfo " id="T3:U4"><span class="var type1" id="S5T3U10">thr</span> = <span class="mxinfo " id="T3:U6"><span class="mxinfo " id="T3:U7">0.3</span>*<span class="mxinfo " id="T3:U8">255</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%Shape = zeros(Settings.Video_width, Settings.Video_heigth);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="mxinfo " id="T2:U9"><span class="var type1" id="S6T2U16">Shape</span> = <span class="mxinfo " id="T2:U11">zeros(<span class="mxinfo " id="T3:U12">512</span>, <span class="mxinfo " id="T3:U13">640</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%OB = Annotations.Tracker.Objects;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="mxinfo " id="T4:U14"><span class="var type1" id="S8T4U23">KL</span> = <span class="mxinfo " id="T4:U16">ones(<span class="mxinfo " id="T3:U17">9</span>,<span class="mxinfo " id="T3:U18">9</span>)./81</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="mxinfo " id="T5:U19"><span class="var type1" id="S10T5U32">KS</span> = <span class="mxinfo " id="T5:U21">ones(<span class="mxinfo " id="T3:U22">3</span>,<span class="mxinfo " id="T3:U23">3</span>)./9</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%Video = 'E:\Studie\Stage Neurobiologie\Videos\VideoDatabase\Tracker Performance\M46_R01_02.dat';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%f = fopen(Video, 'r');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%fstart = 300;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%fseek(f, (fstart-1)*Settings.Video_width*Settings.Video_heigth,'bof');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%fseek(f, (fstart-1)*512*640,'bof');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%frame = fread(f, [Settings.Video_width, Settings.Video_heigth],'*uint8');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%frame = fread(f, [512, 640],'*uint8');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T2:U24"><span class="var type1" id="S11T2U41">LPl</span> = <span class="mxinfo " id="T2:U26">conv2(<span class="var type1" id="S4T2U44">frame</span>, <span class="var type1" id="S8T4U45">KL</span>,<span class="string">'same'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo " id="T2:U29"><span class="var type1" id="S13T2U49">LPs</span> = <span class="mxinfo " id="T2:U31">conv2(<span class="var type1" id="S4T2U52">frame</span>, <span class="var type1" id="S10T5U53">KS</span>,<span class="string">'same'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo " id="T2:U34"><span class="var type1" id="S6T2U58">Shape</span>(:) = <span class="mxinfo " id="T3:U36">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo " id="T6:U37"><span class="mxinfo " id="T6:U38"><span class="var type1" id="S6T2U64">Shape</span>(<span class="mxinfo " id="T7:U40"><span class="var type1" id="S4T2U66">frame</span> &lt;= <span class="var type1" id="S5T3U67">thr</span></span>)</span> = <span class="mxinfo " id="T3:U43">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo " id="T6:U44"><span class="mxinfo " id="T6:U45"><span class="var type1" id="S6T2U72">Shape</span>(<span class="mxinfo " id="T7:U47"><span class="var type1" id="S3T2U74">OB</span>&gt;<span class="mxinfo " id="T3:U49">0</span></span>)</span> = <span class="mxinfo " id="T3:U50">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo " id="T2:U51"><span class="var type1" id="S14T2U79">ShapeSmall</span> = <span class="mxinfo " id="T2:U53">imerode(<span class="var type1" id="S6T2U82">Shape</span>, <span class="mxinfo " id="T8:U55">strel(<span class="string">'diamond'</span>, 2)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%ShapeLarge = imdilate(ShapeSmall, strel('disk', Settings.Dilationsize));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo " id="T2:U56"><span class="var type1" id="S17T2U89">ShapeLarge</span> = <span class="mxinfo " id="T2:U58">imdilate(<span class="var type1" id="S14T2U92">ShapeSmall</span>, <span class="mxinfo " id="T13:U60">strel(<span class="string">'disk'</span>, 20)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo " id="T6:U61"><span class="var type1" id="S19T6U99">SeedEdge</span> = <span class="mxinfo " id="T6:U63">find(<span class="mxinfo " id="T7:U64">edge(<span class="var type1" id="S17T2U104">ShapeLarge</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line">[<span class="var type1" id="S22T6U108">Sx</span>, <span class="var type1" id="S23T6U109">Sy</span>] = ind2sub(<span class="mxinfo " id="T17:U68">size(<span class="var type1" id="S3T2U114">OB</span>)</span>, <span class="var type1" id="S19T6U115">SeedEdge</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="mxinfo " id="T18:U71"><span class="var type1" id="S26T18U118">unmarked</span> = <span class="mxinfo " id="T18:U73">2:<span class="mxinfo " id="T3:U74">length(<span class="var type1" id="S19T6U123">SeedEdge</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo " id="T18:U76"><span class="var type1" id="S28T18U126">marked</span> = <span class="mxinfo " id="T3:U78">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="mxinfo " id="T19:U79"><span class="var type1" id="S29T19U130">temp</span> = <span class="mxinfo " id="T19:U81">zeros(<span class="mxinfo " id="T3:U82">length(<span class="var type1" id="S19T6U135">SeedEdge</span>)</span>, <span class="mxinfo " id="T3:U84">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo " id="T20:U85"><span class="mxinfo " id="T20:U86"><span class="var type1" id="S29T19U140">temp</span>(<span class="mxinfo " id="T3:U88">1</span>,<span class="mxinfo " id="T17:U89">:</span>)</span> = <span class="mxinfo " id="T20:U90">[<span class="mxinfo " id="T3:U91"><span class="var type1" id="S22T6U146">Sx</span>(<span class="mxinfo " id="T3:U93">1</span>)</span>,<span class="mxinfo " id="T3:U94"><span class="var type1" id="S22T6U149">Sx</span>(<span class="mxinfo " id="T3:U96">2</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo " id="T3:U97"><span class="var type1" id="S30T3U153">idx</span> = <span class="mxinfo " id="T3:U99">2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo " id="T9:U100">~<span class="mxinfo " id="T9:U101">isempty(<span class="var type1" id="S26T18U159">unmarked</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line">    <span class="mxinfo " id="T3:U103"><span class="var type1" id="S32T3U162">d</span> = <span class="mxinfo " id="T3:U105">sqrt(<span class="mxinfo " id="T3:U106">sum( <span class="mxinfo " id="T20:U107">(<span class="mxinfo " id="T20:U108"><span class="mxinfo " id="T19:U109">[<span class="mxinfo " id="T6:U110"><span class="var type1" id="S22T6U173">Sx</span>(<span class="var type1" id="S26T18U174">unmarked</span>)</span>,<span class="mxinfo " id="T6:U113"><span class="var type1" id="S23T6U176">Sy</span>(<span class="var type1" id="S26T18U177">unmarked</span>)</span>]</span> - <span class="mxinfo " id="T20:U116">[<span class="mxinfo " id="T3:U117"><span class="var type1" id="S29T19U181">temp</span>(<span class="mxinfo " id="T3:U119">end</span>,<span class="mxinfo " id="T3:U120">1</span>)</span>,<span class="mxinfo " id="T3:U121"><span class="var type1" id="S29T19U186">temp</span>(<span class="mxinfo " id="T3:U123">end</span>,<span class="mxinfo " id="T3:U124">2</span>)</span>]</span></span>).^2</span>, 2)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">    [<span class="mxinfo " id="T3:U125">~</span>, <span class="var type1" id="S36T3U196">id</span>] = min(<span class="var type1" id="S32T3U199">d</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">    <span class="mxinfo " id="T20:U128"><span class="mxinfo " id="T20:U129"><span class="var type1" id="S29T19U203">temp</span>(<span class="var type1" id="S30T3U204">idx</span>,<span class="mxinfo " id="T17:U132">:</span>)</span> = <span class="mxinfo " id="T20:U133">[<span class="mxinfo " id="T3:U134"><span class="var type1" id="S22T6U209">Sx</span>(<span class="mxinfo " id="T3:U136"><span class="var type1" id="S26T18U211">unmarked</span>(<span class="var type1" id="S36T3U212">id</span>)</span>)</span>, <span class="mxinfo " id="T3:U139"><span class="var type1" id="S23T6U214">Sy</span>(<span class="mxinfo " id="T3:U141"><span class="var type1" id="S26T18U216">unmarked</span>(<span class="var type1" id="S36T3U217">id</span>)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">    <span class="mxinfo " id="T18:U144"><span class="var type1" id="S28T18U220">marked</span> = <span class="mxinfo " id="T18:U146">[<span class="var type1" id="S28T18U223">marked</span>, <span class="mxinfo " id="T3:U148"><span class="var type1" id="S26T18U225">unmarked</span>(<span class="var type1" id="S36T3U226">id</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line">    <span class="mxinfo " id="T18:U151"><span class="var type1" id="S26T18U229">unmarked</span> = <span class="mxinfo " id="T18:U153">[<span class="mxinfo " id="T18:U154"><span class="var type1" id="S26T18U233">unmarked</span>(<span class="mxinfo " id="T18:U156"><span class="mxinfo " id="T3:U157">1</span>:<span class="mxinfo " id="T3:U158"><span class="var type1" id="S36T3U237">id</span>-<span class="mxinfo " id="T3:U160">1</span></span></span>)</span>, <span class="mxinfo " id="T18:U161"><span class="var type1" id="S26T18U240">unmarked</span>(<span class="mxinfo " id="T18:U163"><span class="mxinfo " id="T3:U164"><span class="var type1" id="S36T3U243">id</span>+<span class="mxinfo " id="T3:U166">1</span></span>:end</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">    <span class="mxinfo " id="T3:U167"><span class="var type1" id="S30T3U249">idx</span> = <span class="mxinfo " id="T3:U169"><span class="var type1" id="S30T3U251">idx</span>+<span class="mxinfo " id="T3:U171">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo " id="T6:U172"><span class="var type1" id="S19T6U255">SeedEdge</span> = <span class="mxinfo " id="T6:U174">sub2ind(<span class="mxinfo " id="T17:U175">size(<span class="var type1" id="S4T2U260">frame</span>)</span>, <span class="mxinfo " id="T6:U177"><span class="var type1" id="S29T19U262">temp</span>(<span class="mxinfo " id="T21:U179">:</span>,<span class="mxinfo " id="T22:U180">1</span>)</span>, <span class="mxinfo " id="T6:U181"><span class="var type1" id="S29T19U266">temp</span>(<span class="mxinfo " id="T21:U183">:</span>,<span class="mxinfo " id="T22:U184">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo " id="T6:U185"><span class="var type1" id="S39T6U271">SeedProfile</span> = <span class="mxinfo " id="T6:U187">double(<span class="mxinfo " id="T21:U188"><span class="var type1" id="S4T2U275">frame</span>(<span class="var type1" id="S19T6U276">SeedEdge</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%LP = medfilt1(SeedProfile, 500);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="mxinfo " id="T6:U191"><span class="var type1" id="S41T6U279">LP</span> = <span class="mxinfo " id="T6:U193">conv(<span class="var type1" id="S39T6U282">SeedProfile</span>, ones(<span class="mxinfo " id="T3:U195">1</span>,<span class="mxinfo " id="T3:U196">500</span>)./500, <span class="string">'same'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo " id="T6:U197"><span class="var type1" id="S39T6U292">SeedProfile</span> = <span class="mxinfo " id="T6:U199">abs(<span class="mxinfo " id="T6:U200"><span class="var type1" id="S39T6U296">SeedProfile</span> - <span class="var type1" id="S41T6U297">LP</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%[~, SeedIdx] = findpeaks(SeedProfile, 'Threshold', Settings.Origin_threshold);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">[<span class="mxinfo " id="T23:U203">~</span>, <span class="var type1" id="S44T23U302">SeedIdx</span>] = findpeaks(<span class="var type1" id="S39T6U305">SeedProfile</span>, <span class="string">'Threshold'</span>, 0.01);</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo " id="T6:U206"><span class="var type1" id="S46T6U310">SeedsX</span> = <span class="mxinfo " id="T6:U208"><span class="var type1" id="S29T19U312">temp</span>(<span class="var type1" id="S44T23U313">SeedIdx</span>, <span class="mxinfo " id="T22:U211">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo " id="T6:U212"><span class="var type1" id="S47T6U317">SeedsY</span> = <span class="mxinfo " id="T6:U214"><span class="var type1" id="S29T19U319">temp</span>(<span class="var type1" id="S44T23U320">SeedIdx</span>, <span class="mxinfo " id="T3:U217">2</span>)</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="mxinfo " id="T1:U218"><span class="var type1" id="S2T1U324">Trace</span> = <span class="mxinfo " id="T1:U220">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="mxinfo " id="T23:U221"><span class="var type1" id="S48T23U329">angles</span> = <span class="mxinfo " id="T23:U223">repmat(1:20:360,<span class="mxinfo " id="T20:U224">[<span class="mxinfo " id="T3:U225">length(<span class="var type1" id="S46T6U341">SeedsX</span>)</span>,<span class="mxinfo " id="T3:U227">1</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="mxinfo " id="T1:U228"><span class="var type1" id="S50T1U345">theta</span> = <span class="mxinfo " id="T1:U230">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="var type1" id="S50T1U351">theta</span>(<span class="mxinfo " id="T3:U232"><span class="message error" id="M3F1C">1</span></span>,:,:) = <span class="mxinfo " id="T23:U233"><span class="mxinfo " id="T3:U234">3</span>*<span class="mxinfo " id="T23:U235">cosd(<span class="var type1" id="S48T23U359">angles</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="var type1" id="S50T1U363">theta</span>(<span class="mxinfo " id="T3:U238"><span class="message error" id="M4F1C">2</span></span>,:,:) = <span class="mxinfo " id="T23:U239"><span class="mxinfo " id="T3:U240">3</span>*<span class="mxinfo " id="T23:U241">sind(<span class="var type1" id="S48T23U371">angles</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="var type1" id="S2T1U375">Trace</span>(<span class="mxinfo " id="T3:U244"><span class="message error" id="M1F1C">1</span></span>,:,1) = <span class="var type1" id="S46T6U379">SeedsX</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="var type1" id="S2T1U383">Trace</span>(<span class="mxinfo " id="T3:U247"><span class="message error" id="M2F1C">2</span></span>,:,1) = <span class="var type1" id="S47T6U387">SeedsY</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="mxinfo " id="T24:U249"><span class="var type1" id="S53T24U390">T</span> = <span class="mxinfo " id="T24:U251">repmat(<span class="mxinfo " id="T1:U252"><span class="var type1" id="S2T1U394">Trace</span>(<span class="mxinfo " id="T25:U254">:</span>,<span class="mxinfo " id="T25:U255">:</span>,<span class="mxinfo " id="T3:U256">1</span>)</span>, <span class="mxinfo " id="T26:U257">[<span class="mxinfo " id="T3:U258">1</span>, <span class="mxinfo " id="T3:U259">1</span>, <span class="mxinfo " id="T3:U260">size(<span class="var type1" id="S48T23U404">angles</span>,2)</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo " id="T1:U262"><span class="var type1" id="S54T1U408">res</span> = <span class="mxinfo " id="T1:U264">round(<span class="mxinfo " id="T1:U265"><span class="var type1" id="S50T1U412">theta</span>+<span class="var type1" id="S53T24U413">T</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="mxinfo " id="T1:U268"><span class="mxinfo " id="T27:U269"><span class="var type1" id="S54T1U417">res</span>(<span class="mxinfo " id="T27:U271"><span class="var type1" id="S54T1U419">res</span>&lt;1</span>)</span> = <span class="mxinfo " id="T3:U273">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="var type1" id="S54T1U425">res</span>(<span class="var type1" id="S54T1U428">res</span>(<span class="mxinfo " id="T3:U276"><span class="message error" id="M5F1C">1</span></span>,:,:) &gt; 512, :, :) = <span class="mxinfo " id="T3:U277">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="var type1" id="S54T1U439">res</span>(<span class="var type1" id="S54T1U442">res</span>(<span class="mxinfo " id="T3:U280"><span class="message error" id="M6F1C">2</span></span>,:,:) &gt; 640,:,:) = <span class="mxinfo " id="T3:U281">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="mxinfo " id="T6:U282"><span class="mxinfo " id="T6:U283"><span class="var type1" id="S54T1U453">res</span>(<span class="mxinfo " id="T28:U285"><span class="var type1" id="S54T1U455">res</span>&gt;<span class="mxinfo " id="T3:U287">512</span></span>)</span> = <span class="mxinfo " id="T3:U288">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="var type0" id="S56T0U460">Cidx</span> = squeeze(sub2ind(<span class="mxinfo " id="T20:U289">size(<span class="var type1" id="S4T2U467">frame</span>)</span>,  <span class="var type1" id="S54T1U469">res</span>(<span class="mxinfo " id="T3:U292"><span class="message error" id="M7F1C">1</span></span>,:,:), <span class="var type0" id="S54T0U474">res</span>(2,:,:)));</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="var type0" id="S58T0U480">Proi</span> = <span class="var type1" id="S4T2U482">frame</span>(<span class="var type0" id="S56T0U483"><span class="message error" id="M8F1C">Cidx</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="var type0" id="S58T0U487"><span class="message error" id="M9F1C">Proi</span></span>(find(<span class="var type0" id="S17T0U491">ShapeLarge</span>(<span class="var type0" id="S56T0U492">Cidx</span>))) = <span class="mxinfo " id="T3:U294">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">[<span class="message error" id="M11F1C">~</span>, <span class="var type0" id="S59T0U498"><span class="message error" id="M12F1C">minidx</span></span>] = min(<span class="var type0" id="S58T0U501"><span class="message error" id="M10F1C">Proi</span></span>, [], 2);</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="var type0" id="S60T0U507">f</span> = sub2ind(size(<span class="var type0" id="S56T0U512"><span class="message error" id="M13F1C">Cidx</span></span>),1:length(<span class="var type0" id="S59T0U517">minidx</span>),<span class="var type0" id="S59T0U519">minidx</span>');</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">[<span class="message error" id="M15F1C"><span class="var type0" id="S2T0U524">Trace</span>(1,:,2)</span>, <span class="message error" id="M16F1C"><span class="var type0" id="S2T0U529">Trace</span>(2,:,2)</span>] = ind2sub(<span class="mxinfo " id="T20:U295">size(<span class="var type1" id="S4T2U537">frame</span>)</span>, <span class="var type0" id="S56T0U539"><span class="message error" id="M14F1C">Cidx</span></span>(<span class="var type0" id="S60T0U540">f</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"><span class="mxinfo " id="T29:U297"><span class="var type1" id="S61T29U543">H</span> = <span class="mxinfo " id="T29:U299">-30:30</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"><span class="mxinfo " id="T3:U300"><span class="mxinfo " id="T3:U301"><span class="var type1" id="S4T2U551">frame</span>(<span class="mxinfo " id="T3:U303">1</span>,<span class="mxinfo " id="T3:U304">1</span>)</span> = <span class="mxinfo " id="T3:U305">999</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S62T3U557">i</span> = <span class="mxinfo " id="T30:U307"><span class="mxinfo " id="T3:U308">1</span>:<span class="mxinfo " id="T3:U309">100</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">    <span class="mxinfo " id="T3:U310"><span class="var type1" id="S63T3U563">loopidx</span> = <span class="mxinfo " id="T3:U312">size(<span class="var type1" id="S2T1U566">Trace</span>,3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T9:U314">~<span class="mxinfo " id="T9:U315">any(<span class="mxinfo " id="T9:U316">any(<span class="mxinfo " id="T28:U317"><span class="mxinfo " id="T1:U318"><span class="var type1" id="S2T1U577">Trace</span>(<span class="mxinfo " id="T25:U320">:</span>,<span class="mxinfo " id="T25:U321">:</span>,<span class="mxinfo " id="T3:U322">end</span>)</span> ~= <span class="mxinfo " id="T3:U323">1</span></span>)</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">        <span class="keyword">break</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">    <span class="var type0" id="S65T0U586">vt</span> = <span class="var type0" id="S2T0U589">Trace</span>(:,:,<span class="var type0" id="S63T0U592">loopidx</span>) - <span class="var type0" id="S2T0U594">Trace</span>(:,:,<span class="var type0" id="S63T0U598">loopidx</span>-1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">    <span class="var type0" id="S66T0U602">Angles</span> = atan2d(<span class="var type0" id="S65T0U606">vt</span>(2,:), <span class="var type0" id="S65T0U610">vt</span>(1,:));</span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">    <span class="var type0" id="S48T0U615">angles</span> = <span class="var type0" id="S66T0U618">Angles</span>'+<span class="var type0" id="S61T0U619">H</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">    <span class="var type0" id="S50T0U622">theta</span> = [];</span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">    <span class="var type0" id="S50T0U628">theta</span>(1,:,:) = 5*cosd(<span class="var type0" id="S48T0U636">angles</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">    <span class="var type0" id="S50T0U640">theta</span>(2,:,:) = 5*sind(<span class="var type0" id="S48T0U648">angles</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">    <span class="var type0" id="S53T0U651">T</span> = repmat(<span class="var type0" id="S2T0U655">Trace</span>(:,:,<span class="var type0" id="S63T0U658">loopidx</span>), [1, 1, size(<span class="var type0" id="S48T0U665">angles</span>,2)]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">    <span class="var type0" id="S54T0U669">res</span> = round(<span class="var type0" id="S50T0U673">theta</span>+<span class="var type0" id="S53T0U674">T</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">    <span class="var type0" id="S54T0U678">res</span>(<span class="var type0" id="S54T0U680">res</span>&lt;1) = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line">    <span class="var type0" id="S54T0U686">res</span>(<span class="var type0" id="S54T0U689">res</span>(1,:,:) &gt; 640, :, :) = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">    <span class="var type0" id="S54T0U700">res</span>(<span class="var type0" id="S54T0U703">res</span>(2,:,:) &gt; 512,:,:) = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line">    <span class="var type0" id="S54T0U714">res</span>(<span class="var type0" id="S54T0U716">res</span>&gt;512) = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">    <span class="var type0" id="S56T0U721">Cidx</span> = squeeze(sub2ind(size(<span class="var type0" id="S4T0U728">frame</span>), <span class="var type0" id="S54T0U730">res</span>(1,:,:), <span class="var type0" id="S54T0U735">res</span>(2,:,:)));</span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">    <span class="var type0" id="S58T0U741">Proi</span> = <span class="var type0" id="S4T0U743">frame</span>(<span class="var type0" id="S56T0U744">Cidx</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">    [~, <span class="var type0" id="S59T0U749">minidx</span>] = min(<span class="var type0" id="S58T0U752">Proi</span>, [], 2);</span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">    <span class="var type0" id="S60T0U758">f</span>=  sub2ind(size(<span class="var type0" id="S56T0U763">Cidx</span>), 1:length(<span class="var type0" id="S59T0U768">minidx</span>), <span class="var type0" id="S59T0U770">minidx</span>');</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">    <span class="comment">%nanidx = [find(OB(Cidx(f))), find(LPs(Cidx(f))./LPl(Cidx(f)) &gt; Settings.trace_threshold)];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">    <span class="var type0" id="S68T0U773">nanidx</span> = [find(<span class="var type0" id="S3T0U779">OB</span>(<span class="var type0" id="S56T0U781">Cidx</span>(<span class="var type0" id="S60T0U782">f</span>))), find(<span class="var type0" id="S13T0U788">LPs</span>(<span class="var type0" id="S56T0U790">Cidx</span>(<span class="var type0" id="S60T0U791">f</span>))./<span class="var type0" id="S11T0U793">LPl</span>(<span class="var type0" id="S56T0U795">Cidx</span>(<span class="var type0" id="S60T0U796">f</span>)) &gt; 0.98)];</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">    [<span class="var type0" id="S2T0U802">Trace</span>(1,:,<span class="var type0" id="S63T0U806">loopidx</span>+1), <span class="var type0" id="S2T0U809">Trace</span>(2,:,<span class="var type0" id="S63T0U813">loopidx</span>+1)] = ind2sub(size(<span class="var type0" id="S4T0U819">frame</span>), <span class="var type0" id="S56T0U821">Cidx</span>(<span class="var type0" id="S60T0U822">f</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">    <span class="var type0" id="S2T0U826">Trace</span>(1:2,<span class="var type0" id="S68T0U830">nanidx</span>, <span class="var type0" id="S63T0U832">loopidx</span>+1) = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"><span class="mxinfo " id="T6:U324"><span class="mxinfo " id="T6:U325"><span class="var type1" id="S2T1U838">Trace</span>(<span class="mxinfo " id="T28:U327"><span class="var type1" id="S2T1U840">Trace</span> == <span class="mxinfo " id="T3:U329">1</span></span> )</span> = <span class="mxinfo " id="T3:U330">NaN</span></span>;</span></span>
</pre>
